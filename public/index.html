<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <title>VoiceBot Demo Activity - Config</title>

    <style>
        body {
        font-family: Arial, sans-serif;
        padding: 20px;
        }
        h3 {
        margin-top: 0;
        }
    </style>
    </head>

    <body>

    <h3>VoiceBot Demo Activity - Config UI</h3>
    <p>UI cargada correctamente.</p>

    <!-- Postmonger (OBLIGATORIO) -->
    <script src="https://unpkg.com/postmonger/postmonger.js"></script>

    <script>
        /**
        * Sesi贸n con Journey Builder
        */
        const connection = new Postmonger.Session();

        /**
        * Activity actual (payload que env铆a Journey Builder)
        */
        let activity = null;

        /**
        * 1锔 Avisar a Journey Builder que la UI ya carg贸
        *    (quita el spinner)
        */
        connection.trigger('ready');

        /**
        * 2锔 Recibir el payload inicial de la activity
        */
        connection.on('initActivity', function (payload) {
        console.log('initActivity payload:', payload);
        activity = payload;
        });

        /**
        * 3锔 Usuario da click en "Listo"
        *     OBLIGATORIO devolver updateActivity
        */
        connection.on('clickedNext', function () {
        console.log('clickedNext');

        // Seguridad m铆nima
        if (!activity) {
            activity = {
            arguments: {},
            metaData: {}
            };
        }

        // Marcar activity como configurada
        activity.metaData = activity.metaData || {};
        activity.metaData.isConfigured = true;

        // Definir argumentos de ejecuci贸n (execute)
        activity.arguments = activity.arguments || {};
        activity.arguments.execute = activity.arguments.execute || {};

        activity.arguments.execute.inArguments = [
            { contactKey: "{{Contact.Key}}" },
            { email: "{{Contact.Default.Email}}" }
        ];

        activity.arguments.execute.url =
            "https://sfmc-custom-activity-vercel.vercel.app/api/execute";

        /**
        *  ESTE EVENTO CIERRA EL MODAL
        *    y guarda la configuraci贸n
        */
        connection.trigger('updateActivity', activity);
        });

        /**
        * 4锔 (Opcional) Bot贸n "Atr谩s"
        */
        connection.on('clickedBack', function () {
        connection.trigger('prevStep');
        });
    </script>

</body>
</html>